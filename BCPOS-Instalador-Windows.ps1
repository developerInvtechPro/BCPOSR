# =====================================================
# BCPOS - INSTALADOR COMPLETO PARA WINDOWS
# Instalador definitivo con todas las funcionalidades
# =====================================================

Add-Type -AssemblyName System.Windows.Forms
Add-Type -AssemblyName System.Drawing

Write-Host "üöÄ BCPOS - INSTALADOR COMPLETO PARA WINDOWS" -ForegroundColor Green
Write-Host "===========================================" -ForegroundColor Green

# Configuraci√≥n de rutas
$FACTURACION_PATH = "$env:USERPROFILE\Downloads\facturacion-app"
$BCPOS_PATH = "$env:USERPROFILE\Desktop\BCPOS"

# Funci√≥n para mostrar mensaje
function Show-Message {
    param([string]$Title, [string]$Message, [string]$Type = "Information")
    
    $icon = switch ($Type) {
        "Error" { [System.Windows.Forms.MessageBoxIcon]::Error }
        "Warning" { [System.Windows.Forms.MessageBoxIcon]::Warning }
        "Question" { [System.Windows.Forms.MessageBoxIcon]::Question }
        default { [System.Windows.Forms.MessageBoxIcon]::Information }
    }
    
    [System.Windows.Forms.MessageBox]::Show($Message, $Title, [System.Windows.Forms.MessageBoxButtons]::OK, $icon)
}

# Funci√≥n para escribir archivo sin BOM
function Write-FileNoBOM {
    param([string]$FilePath, [string]$Content)
    
    $utf8NoBom = New-Object System.Text.UTF8Encoding $false
    [System.IO.File]::WriteAllText($FilePath, $Content, $utf8NoBom)
}

# Funci√≥n para verificar Node.js
function Test-NodeJS {
    try {
        $nodeVersion = node --version 2>$null
        if ($nodeVersion) {
            Write-Host "‚úÖ Node.js encontrado: $nodeVersion" -ForegroundColor Green
            return $true
        }
    } catch {
        return $false
    }
    return $false
}

# Funci√≥n para instalar Node.js
function Install-NodeJS {
    Write-Host "üì¶ Descargando e instalando Node.js..." -ForegroundColor Yellow
    
    $nodeUrl = "https://nodejs.org/dist/v20.10.0/node-v20.10.0-x64.msi"
    $nodeInstaller = "$env:TEMP\nodejs-installer.msi"
    
    try {
        Invoke-WebRequest -Uri $nodeUrl -OutFile $nodeInstaller
        Start-Process msiexec.exe -ArgumentList "/i", $nodeInstaller, "/quiet" -Wait
        Remove-Item $nodeInstaller -Force
        
        # Actualizar PATH
        $env:PATH = [System.Environment]::GetEnvironmentVariable("PATH", "Machine") + ";" + [System.Environment]::GetEnvironmentVariable("PATH", "User")
        
        Write-Host "‚úÖ Node.js instalado correctamente" -ForegroundColor Green
        return $true
    } catch {
        Write-Host "‚ùå Error instalando Node.js: $_" -ForegroundColor Red
        return $false
    }
}

Write-Host "üîç Verificando requisitos del sistema..." -ForegroundColor Yellow

# Verificar Node.js
if (-not (Test-NodeJS)) {
    $installNode = [System.Windows.Forms.MessageBox]::Show(
        "Node.js no est√° instalado. ¬øDesea instalarlo autom√°ticamente?",
        "Node.js Requerido",
        [System.Windows.Forms.MessageBoxButtons]::YesNo,
        [System.Windows.Forms.MessageBoxIcon]::Question
    )
    
    if ($installNode -eq [System.Windows.Forms.DialogResult]::Yes) {
        if (-not (Install-NodeJS)) {
            Show-Message "Error" "No se pudo instalar Node.js. Por favor inst√°lelo manualmente desde nodejs.org" "Error"
            exit
        }
    } else {
        Show-Message "Cancelado" "Node.js es requerido para BCPOS. Instalaci√≥n cancelada." "Warning"
        exit
    }
}

# Mostrar opciones de instalaci√≥n
$installOptions = [System.Windows.Forms.MessageBox]::Show(
    "Seleccione el tipo de instalaci√≥n:`n`n‚Ä¢ S√ç: Instalaci√≥n completa (recomendado)`n  - Crea BCPOS desde cero`n  - Integra sistema completo`n  - Configura inicio autom√°tico`n`n‚Ä¢ NO: Solo integrar sistema existente`n  - Requiere BCPOS ya instalado`n  - Solo copia archivos del sistema",
    "Tipo de Instalaci√≥n",
    [System.Windows.Forms.MessageBoxButtons]::YesNo,
    [System.Windows.Forms.MessageBoxIcon]::Question
)

if ($installOptions -eq [System.Windows.Forms.DialogResult]::Yes) {
    # INSTALACI√ìN COMPLETA
    Write-Host "`nüöÄ INICIANDO INSTALACI√ìN COMPLETA..." -ForegroundColor Green
    
    # Crear directorio BCPOS
    if (Test-Path $BCPOS_PATH) {
        $overwrite = [System.Windows.Forms.MessageBox]::Show(
            "El directorio BCPOS ya existe. ¬øDesea sobrescribirlo?",
            "Directorio Existente",
            [System.Windows.Forms.MessageBoxButtons]::YesNo,
            [System.Windows.Forms.MessageBoxIcon]::Warning
        )
        
        if ($overwrite -eq [System.Windows.Forms.DialogResult]::Yes) {
            Remove-Item $BCPOS_PATH -Recurse -Force
        } else {
            Show-Message "Cancelado" "Instalaci√≥n cancelada."
            exit
        }
    }
    
    New-Item -ItemType Directory -Path $BCPOS_PATH -Force | Out-Null
    Write-Host "‚úÖ Directorio BCPOS creado" -ForegroundColor Green
    
    # Crear estructura completa
    Write-Host "`nüìÅ Creando estructura del proyecto..." -ForegroundColor Yellow
    
    $directories = @(
        "src\components",
        "src\pages\api\inventory",
        "src\lib",
        "prisma",
        "scripts",
        "public"
    )
    
    foreach ($dir in $directories) {
        $fullPath = Join-Path $BCPOS_PATH $dir
        New-Item -ItemType Directory -Path $fullPath -Force | Out-Null
    }
    
    # Crear package.json
    Write-Host "`nüì¶ Creando package.json..." -ForegroundColor Yellow
    
    $packageJson = @{
        name = "bcpos"
        version = "1.0.0"
        description = "Sistema POS completo con inventario - BCPOS"
        scripts = @{
            dev = "next dev"
            build = "next build"
            start = "next start"
            lint = "next lint"
            "db:generate" = "prisma generate"
            "db:push" = "prisma db push"
            "db:seed" = "node scripts/seed-inventory.js"
            "db:studio" = "prisma studio"
        }
        dependencies = @{
            "next" = "14.1.0"
            "react" = "^18"
            "react-dom" = "^18"
            "@prisma/client" = "^5.22.0"
            "@mui/material" = "^5.15.0"
            "@emotion/react" = "^11.11.0"
            "@emotion/styled" = "^11.11.0"
            "@mui/icons-material" = "^5.15.0"
            "@mui/x-data-grid" = "^6.18.0"
            "recharts" = "^2.8.0"
        }
        devDependencies = @{
            "prisma" = "^5.22.0"
            "@types/node" = "^20"
            "@types/react" = "^18"
            "@types/react-dom" = "^18"
            "typescript" = "^5"
        }
    }
    
    $packageJsonContent = $packageJson | ConvertTo-Json -Depth 10
    Write-FileNoBOM (Join-Path $BCPOS_PATH "package.json") $packageJsonContent
    
} else {
    # SOLO INTEGRACI√ìN
    Write-Host "`nüîÑ INICIANDO INTEGRACI√ìN DEL SISTEMA..." -ForegroundColor Green
    
    # Verificar que BCPOS existe
    if (-not (Test-Path $BCPOS_PATH)) {
        Show-Message "Error" "No se encontr√≥ BCPOS en:`n$BCPOS_PATH`n`nPor favor use la instalaci√≥n completa." "Error"
        exit
    }
}

# Verificar facturacion-app
if (Test-Path $FACTURACION_PATH) {
    Write-Host "`nüìã Integrando archivos del sistema..." -ForegroundColor Yellow
    
    # Archivos a copiar
    $filesToCopy = @(
        @{ Source = "src\pages\index.tsx"; Dest = "src\pages\index.tsx" },
        @{ Source = "src\components\InventoryManager.tsx"; Dest = "src\components\InventoryManager.tsx" },
        @{ Source = "src\lib\inventory-service.ts"; Dest = "src\lib\inventory-service.ts" },
        @{ Source = "scripts\seed-inventory.js"; Dest = "scripts\seed-inventory.js" }
    )
    
    # APIs de inventario
    $apiFiles = @(
        "src\pages\api\inventory\items.ts",
        "src\pages\api\inventory\movements.ts",
        "src\pages\api\inventory\summary.ts",
        "src\pages\api\inventory\vendors.ts",
        "src\pages\api\inventory\purchase-orders.ts",
        "src\pages\api\inventory\recipes.ts"
    )
    
    foreach ($apiFile in $apiFiles) {
        $filesToCopy += @{ Source = $apiFile; Dest = $apiFile }
    }
    
    # Copiar archivos
    foreach ($file in $filesToCopy) {
        $sourcePath = Join-Path $FACTURACION_PATH $file.Source
        $destPath = Join-Path $BCPOS_PATH $file.Dest
        
        if (Test-Path $sourcePath) {
            try {
                $destDir = Split-Path $destPath -Parent
                if (-not (Test-Path $destDir)) {
                    New-Item -ItemType Directory -Path $destDir -Force | Out-Null
                }
                
                Copy-Item $sourcePath $destPath -Force
                Write-Host "‚úÖ Copiado: $($file.Source)" -ForegroundColor Green
            } catch {
                Write-Host "‚ùå Error copiando: $($file.Source)" -ForegroundColor Red
            }
        }
    }
}

Write-Host "`nüóÑÔ∏è Configurando base de datos..." -ForegroundColor Yellow

# Crear schema.prisma
$prismaSchema = @"
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Item {
  id          String   @id @default(cuid())
  name        String
  description String?
  sku         String   @unique
  category    String
  price       Float
  cost        Float
  stock       Int      @default(0)
  minStock    Int      @default(0)
  maxStock    Int      @default(100)
  unit        String   @default("unidad")
  barcode     String?  @unique
  image       String?
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  movements   Movement[]
  orderItems  PurchaseOrderItem[]
  recipeItems RecipeItem[]

  @@map("items")
}

model Movement {
  id          String      @id @default(cuid())
  itemId      String
  type        MovementType
  quantity    Int
  cost        Float?
  price       Float?
  reference   String?
  notes       String?
  createdAt   DateTime    @default(now())
  
  item        Item        @relation(fields: [itemId], references: [id])

  @@map("movements")
}

model Vendor {
  id            String          @id @default(cuid())
  name          String
  contact       String?
  email         String?
  phone         String?
  address       String?
  active        Boolean         @default(true)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  purchaseOrders PurchaseOrder[]

  @@map("vendors")
}

model PurchaseOrder {
  id          String              @id @default(cuid())
  vendorId    String
  orderNumber String              @unique
  status      PurchaseOrderStatus @default(PENDING)
  orderDate   DateTime            @default(now())
  expectedDate DateTime?
  receivedDate DateTime?
  total       Float               @default(0)
  notes       String?
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt

  vendor      Vendor              @relation(fields: [vendorId], references: [id])
  items       PurchaseOrderItem[]

  @@map("purchase_orders")
}

model PurchaseOrderItem {
  id              String        @id @default(cuid())
  purchaseOrderId String
  itemId          String
  quantity        Int
  cost            Float
  received        Int           @default(0)
  
  purchaseOrder   PurchaseOrder @relation(fields: [purchaseOrderId], references: [id])
  item            Item          @relation(fields: [itemId], references: [id])

  @@map("purchase_order_items")
}

model Recipe {
  id          String       @id @default(cuid())
  name        String
  description String?
  yield       Int          @default(1)
  unit        String       @default("porci√≥n")
  cost        Float        @default(0)
  active      Boolean      @default(true)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  items       RecipeItem[]

  @@map("recipes")
}

model RecipeItem {
  id        String @id @default(cuid())
  recipeId  String
  itemId    String
  quantity  Float
  unit      String @default("unidad")
  
  recipe    Recipe @relation(fields: [recipeId], references: [id])
  item      Item   @relation(fields: [itemId], references: [id])

  @@map("recipe_items")
}

enum MovementType {
  IN
  OUT
  ADJUSTMENT
  TRANSFER
}

enum PurchaseOrderStatus {
  PENDING
  ORDERED
  PARTIAL
  RECEIVED
  CANCELLED
}
"@

Write-FileNoBOM (Join-Path $BCPOS_PATH "prisma\schema.prisma") $prismaSchema

# Crear .env
$envContent = @"
# CONFIGURACI√ìN BCPOS - SISTEMA COMPLETO
DATABASE_URL="file:./bcpos.db"

# Business Central - PRECONFIGURADO HONDURAS
BC_TENANT_ID=0b48b68c-f813-4060-844f-2079fe72f87c
BC_CLIENT_ID=570853f4-2ca4-4dce-a433-a5322fa215fa
BC_CLIENT_SECRET=7i88Q~CJTBJ4a9LPLPW93Bjb6bJSiNprbkVGUbdG
BC_ENVIRONMENT=SB110225
BC_COMPANY_ID=88a8517e-4be2-ef11-9345-002248e0e739

# Configuraci√≥n del Sistema
PORT=3000
NEXTAUTH_SECRET=bcpos-secret-key-2024
NEXTAUTH_URL=http://localhost:3000

# Configuraci√≥n de Empresa
EMPRESA_NOMBRE="BCPOS - Sistema de Punto de Venta"
EMPRESA_RTN="08011999123456"
EMPRESA_DIRECCION="Tegucigalpa, Honduras"
EMPRESA_TELEFONO="2234-5678"

# Configuraci√≥n de Impresi√≥n
PRINTER_NAME="POS-80"
PRINTER_WIDTH=48
"@

Write-FileNoBOM (Join-Path $BCPOS_PATH ".env") $envContent

# Crear archivos de configuraci√≥n
Write-Host "`n‚öôÔ∏è Creando archivos de configuraci√≥n..." -ForegroundColor Yellow

# next.config.js
$nextConfig = @"
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  swcMinify: true,
  experimental: {
    serverComponentsExternalPackages: ['@prisma/client']
  }
}

module.exports = nextConfig
"@

Write-FileNoBOM (Join-Path $BCPOS_PATH "next.config.js") $nextConfig

# tsconfig.json
$tsConfig = @"
{
  "compilerOptions": {
    "target": "es5",
    "lib": ["dom", "dom.iterable", "es6"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
"@

Write-FileNoBOM (Join-Path $BCPOS_PATH "tsconfig.json") $tsConfig

Write-Host "`nüìã Creando scripts de gesti√≥n..." -ForegroundColor Yellow

# Script de configuraci√≥n
$setupScript = @"
@echo off
title BCPOS - Configuraci√≥n Completa
cd /d "$BCPOS_PATH"

echo ================================================
echo  üöÄ BCPOS - CONFIGURACI√ìN COMPLETA
echo     Sistema POS con Inventario
echo ================================================
echo.

echo üì¶ Instalando dependencias...
npm install

echo üóÑÔ∏è Configurando base de datos...
npx prisma generate
npx prisma db push

echo üå± Poblando datos iniciales...
if exist scripts\seed-inventory.js (
    node scripts\seed-inventory.js
) else (
    echo ‚ö†Ô∏è Script de seed no encontrado, continuando...
)

echo.
echo ‚úÖ CONFIGURACI√ìN COMPLETADA
echo üöÄ Para iniciar el sistema ejecute: npm run dev
echo üì± Acceso: http://localhost:3000
echo.
pause
"@

$setupScript | Out-File -FilePath (Join-Path $BCPOS_PATH "configurar-sistema.bat") -Encoding ASCII

# Script de inicio
$startScript = @"
@echo off
title BCPOS - Sistema Completo
cd /d "$BCPOS_PATH"

echo ================================================
echo  üöÄ BCPOS - SISTEMA COMPLETO
echo     POS + Inventario + Business Central
echo ================================================
echo.

REM Verificar si el servidor ya est√° corriendo
netstat -an | find "3000" >nul
if %errorlevel% == 0 (
    echo ‚úÖ Servidor ya est√° corriendo
    echo üåê Abriendo navegador...
    start http://localhost:3000
    timeout /t 3 /nobreak >nul
    exit
)

echo üîÑ Iniciando servidor BCPOS...
start /min npm run dev

echo ‚è≥ Esperando que el servidor est√© listo...
timeout /t 20 /nobreak >nul

echo üåê Abriendo navegador...
start http://localhost:3000

echo.
echo ‚úÖ BCPOS iniciado correctamente
echo üì± Sistema POS: http://localhost:3000
echo.
timeout /t 3 /nobreak >nul
"@

$startScript | Out-File -FilePath (Join-Path $BCPOS_PATH "IniciarBCPOS.bat") -Encoding ASCII

# Script de inicio autom√°tico
$autoStartScript = @"
@echo off
title BCPOS - Inicio Autom√°tico
cd /d "$BCPOS_PATH"

REM Esperar 30 segundos para que Windows termine de cargar
timeout /t 30 /nobreak >nul

REM Verificar si ya est√° corriendo
netstat -an | find ":3000" | find "LISTENING" >nul
if %errorlevel% == 0 (
    exit
)

REM Iniciar BCPOS en modo minimizado
start /min "BCPOS-AutoStart" npm run dev

REM Esperar y verificar
timeout /t 20 /nobreak >nul

REM Mostrar notificaci√≥n si est√° listo
curl -s http://localhost:3000 >nul 2>&1
if %errorlevel% == 0 (
    powershell -Command "Add-Type -AssemblyName System.Windows.Forms; [System.Windows.Forms.MessageBox]::Show('BCPOS iniciado autom√°ticamente\nDisponible en: http://localhost:3000', 'BCPOS', 'OK', 'Information')"
)
"@

$autoStartScript | Out-File -FilePath (Join-Path $BCPOS_PATH "inicio-automatico.bat") -Encoding ASCII

# Script de gesti√≥n de inicio autom√°tico
$manageAutoStartScript = @"
@echo off
title BCPOS - Gesti√≥n de Inicio Autom√°tico
cls

:menu
echo ================================================
echo  üöÄ BCPOS - GESTI√ìN DE INICIO AUTOM√ÅTICO
echo ================================================
echo.
echo 1. ‚úÖ Habilitar inicio autom√°tico
echo 2. ‚ùå Deshabilitar inicio autom√°tico
echo 3. üìä Ver estado actual
echo 4. üöÄ Iniciar BCPOS ahora
echo 5. ‚èπÔ∏è  Detener BCPOS
echo 6. üåê Abrir BCPOS en navegador
echo 7. üîÑ Reiniciar BCPOS
echo 8. ‚ùå Salir
echo.
set /p choice="Seleccione una opci√≥n (1-8): "

if "%choice%"=="1" goto enable
if "%choice%"=="2" goto disable
if "%choice%"=="3" goto status
if "%choice%"=="4" goto start
if "%choice%"=="5" goto stop
if "%choice%"=="6" goto open
if "%choice%"=="7" goto restart
if "%choice%"=="8" goto exit

goto menu

:enable
echo üîß Habilitando inicio autom√°tico...
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Run" /v "BCPOS" /t REG_SZ /d "$BCPOS_PATH\inicio-automatico.bat" /f
echo ‚úÖ Inicio autom√°tico habilitado
timeout /t 3 /nobreak >nul
goto menu

:disable
echo üîß Deshabilitando inicio autom√°tico...
reg delete "HKCU\Software\Microsoft\Windows\CurrentVersion\Run" /v "BCPOS" /f 2>nul
echo ‚úÖ Inicio autom√°tico deshabilitado
timeout /t 3 /nobreak >nul
goto menu

:status
echo üìä Estado del inicio autom√°tico:
reg query "HKCU\Software\Microsoft\Windows\CurrentVersion\Run" /v "BCPOS" 2>nul
if %errorlevel% == 0 (
    echo ‚úÖ BCPOS est√° configurado para inicio autom√°tico
) else (
    echo ‚ùå BCPOS NO est√° configurado para inicio autom√°tico
)
echo.
pause
goto menu

:start
echo üöÄ Iniciando BCPOS...
cd /d "$BCPOS_PATH"
start /min "BCPOS-Manual" npm run dev
echo ‚úÖ BCPOS iniciado
timeout /t 3 /nobreak >nul
goto menu

:stop
echo ‚èπÔ∏è Deteniendo BCPOS...
taskkill /F /IM node.exe /FI "WINDOWTITLE eq*BCPOS*" 2>nul
echo ‚úÖ BCPOS detenido
timeout /t 3 /nobreak >nul
goto menu

:open
echo üåê Abriendo BCPOS...
start http://localhost:3000
timeout /t 2 /nobreak >nul
goto menu

:restart
echo üîÑ Reiniciando BCPOS...
taskkill /F /IM node.exe /FI "WINDOWTITLE eq*BCPOS*" 2>nul
timeout /t 3 /nobreak >nul
cd /d "$BCPOS_PATH"
start /min "BCPOS-Restart" npm run dev
echo ‚úÖ BCPOS reiniciado
timeout /t 3 /nobreak >nul
goto menu

:exit
exit
"@

$manageAutoStartScript | Out-File -FilePath (Join-Path $BCPOS_PATH "gestionar-inicio-automatico.bat") -Encoding ASCII

Write-Host "`nüñ•Ô∏è Creando iconos de escritorio..." -ForegroundColor Yellow

# Crear iconos en el escritorio
$desktopPath = [Environment]::GetFolderPath("Desktop")
$WshShell = New-Object -ComObject WScript.Shell

# Icono principal
$Shortcut = $WshShell.CreateShortcut("$desktopPath\üöÄ BCPOS.lnk")
$Shortcut.TargetPath = "$BCPOS_PATH\IniciarBCPOS.bat"
$Shortcut.WorkingDirectory = $BCPOS_PATH
$Shortcut.Description = "BCPOS - Sistema POS Completo"
$Shortcut.Save()

# Icono de configuraci√≥n
$Shortcut = $WshShell.CreateShortcut("$desktopPath\‚öôÔ∏è Configurar BCPOS.lnk")
$Shortcut.TargetPath = "$BCPOS_PATH\configurar-sistema.bat"
$Shortcut.WorkingDirectory = $BCPOS_PATH
$Shortcut.Description = "BCPOS - Configurar sistema"
$Shortcut.Save()

# Icono de gesti√≥n de inicio autom√°tico
$Shortcut = $WshShell.CreateShortcut("$desktopPath\üîÑ Gestionar Inicio BCPOS.lnk")
$Shortcut.TargetPath = "$BCPOS_PATH\gestionar-inicio-automatico.bat"
$Shortcut.WorkingDirectory = $BCPOS_PATH
$Shortcut.Description = "BCPOS - Gestionar inicio autom√°tico"
$Shortcut.Save()

Write-Host "`nüéâ INSTALACI√ìN COMPLETADA" -ForegroundColor Green
Write-Host "=========================" -ForegroundColor Green

$summary = @"

‚úÖ BCPOS INSTALADO CORRECTAMENTE

üìã COMPONENTES INSTALADOS:

üñ•Ô∏è SISTEMA POS COMPLETO:
   ‚Ä¢ Punto de venta con todas las funcionalidades
   ‚Ä¢ Gesti√≥n de mesas, delivery, pickup
   ‚Ä¢ Facturaci√≥n con CAI
   ‚Ä¢ M√∫ltiples formas de pago
   ‚Ä¢ Apertura autom√°tica de caj√≥n

üì¶ INVENTARIO AVANZADO:
   ‚Ä¢ Gesti√≥n de art√≠culos
   ‚Ä¢ Movimientos de inventario
   ‚Ä¢ √ìrdenes de compra
   ‚Ä¢ Recetas y componentes
   ‚Ä¢ Proveedores

üîó BUSINESS CENTRAL:
   ‚Ä¢ Integraci√≥n preconfigurada para Honduras
   ‚Ä¢ Sincronizaci√≥n autom√°tica de datos

üóÑÔ∏è BASE DE DATOS:
   ‚Ä¢ SQLite local configurada
   ‚Ä¢ Prisma ORM
   ‚Ä¢ Esquema completo

üñ•Ô∏è ICONOS CREADOS:
   ‚Ä¢ üöÄ BCPOS - Iniciar sistema
   ‚Ä¢ ‚öôÔ∏è Configurar BCPOS - Instalar dependencias
   ‚Ä¢ üîÑ Gestionar Inicio BCPOS - Configurar inicio autom√°tico

üöÄ PR√ìXIMOS PASOS:
   1. Ejecutar: ‚öôÔ∏è Configurar BCPOS (instala dependencias)
   2. Configurar: üîÑ Gestionar Inicio BCPOS (opcional)
   3. Iniciar: üöÄ BCPOS
   4. Acceder: http://localhost:3000

‚úÖ ¬°BCPOS listo para usar!
"@

Show-Message "¬°Instalaci√≥n Exitosa!" $summary

Write-Host $summary -ForegroundColor Cyan

# Preguntar si desea configurar ahora
$configNow = [System.Windows.Forms.MessageBox]::Show(
    "¬øDesea ejecutar la configuraci√≥n completa ahora?`n`nEsto instalar√° dependencias y configurar√° la base de datos.",
    "Configurar Ahora",
    [System.Windows.Forms.MessageBoxButtons]::YesNo,
    [System.Windows.Forms.MessageBoxIcon]::Question
)

if ($configNow -eq [System.Windows.Forms.DialogResult]::Yes) {
    Write-Host "`nüîÑ Ejecutando configuraci√≥n..." -ForegroundColor Yellow
    Start-Process "$BCPOS_PATH\configurar-sistema.bat" -Wait
    
    Write-Host "`nüéâ ¬°Sistema listo para usar!" -ForegroundColor Green
    
    # Preguntar sobre inicio autom√°tico
    $autoStart = [System.Windows.Forms.MessageBox]::Show(
        "¬øDesea configurar BCPOS para inicio autom√°tico con Windows?",
        "Inicio Autom√°tico",
        [System.Windows.Forms.MessageBoxButtons]::YesNo,
        [System.Windows.Forms.MessageBoxIcon]::Question
    )
    
    if ($autoStart -eq [System.Windows.Forms.DialogResult]::Yes) {
        # Configurar inicio autom√°tico
        try {
            $startupPath = Join-Path $BCPOS_PATH "inicio-automatico.bat"
            Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run" -Name "BCPOS" -Value $startupPath
            Write-Host "‚úÖ Inicio autom√°tico configurado" -ForegroundColor Green
            Show-Message "Configurado" "BCPOS se iniciar√° autom√°ticamente con Windows."
        } catch {
            Write-Host "‚ö†Ô∏è Error configurando inicio autom√°tico" -ForegroundColor Yellow
        }
    }
    
    $startNow = [System.Windows.Forms.MessageBox]::Show(
        "¬øDesea iniciar BCPOS ahora?",
        "Iniciar Sistema",
        [System.Windows.Forms.MessageBoxButtons]::YesNo,
        [System.Windows.Forms.MessageBoxIcon]::Question
    )
    
    if ($startNow -eq [System.Windows.Forms.DialogResult]::Yes) {
        Start-Process "$BCPOS_PATH\IniciarBCPOS.bat"
    }
}

Write-Host "`n¬°Instalaci√≥n finalizada!" -ForegroundColor Green
Read-Host "Presione Enter para salir" 